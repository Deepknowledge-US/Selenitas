{"ast":null,"code":"import _slicedToArray from\"/home/one/NIN/nin_0.3.2/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{createContext,useEffect,useState}from'react';import Connection from'./Connection';import Publisher from'./Publisher';import Subscriber from'./Subscriber';import Receiver from'./Receiver';import mqtt from'mqtt';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var QosOption=/*#__PURE__*/createContext([]);var qosOption=[{label:'0',value:0},{label:'1',value:1},{label:'2',value:2}];var HookMqtt=function HookMqtt(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),client=_useState2[0],setClient=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isSubed=_useState4[0],setIsSub=_useState4[1];var _useState5=useState({}),_useState6=_slicedToArray(_useState5,2),payload=_useState6[0],setPayload=_useState6[1];var _useState7=useState('Connect'),_useState8=_slicedToArray(_useState7,2),connectStatus=_useState8[0],setConnectStatus=_useState8[1];var mqttConnect=function mqttConnect(host,mqttOption){setConnectStatus('Connecting');setClient(mqtt.connect(host,mqttOption));};useEffect(function(){if(client){client.on('connect',function(){setConnectStatus('Connected');});client.on('error',function(err){console.error('Connection error: ',err);client.end();});client.on('reconnect',function(){setConnectStatus('Reconnecting');});client.on('message',function(topic,message){var payload={topic:topic,message:message.toString()};setPayload(payload);});}},[client]);var mqttDisconnect=function mqttDisconnect(){if(client){client.end(function(){setConnectStatus('Connect');});}};var mqttPublish=function mqttPublish(context){if(client){var topic=context.topic,qos=context.qos,_payload=context.payload;client.publish(topic,_payload,{qos:qos},function(error){if(error){console.log('Publish error: ',error);}});}};var mqttSub=function mqttSub(subscription){if(client){var topic=subscription.topic,qos=subscription.qos;client.subscribe(topic,{qos:qos},function(error){if(error){console.log('Subscribe to topics error',error);return;}setIsSub(true);});}};var mqttUnSub=function mqttUnSub(subscription){if(client){var topic=subscription.topic;client.unsubscribe(topic,function(error){if(error){console.log('Unsubscribe error',error);return;}setIsSub(false);});}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Connection,{connect:mqttConnect,disconnect:mqttDisconnect,connectBtn:connectStatus}),/*#__PURE__*/_jsxs(QosOption.Provider,{value:qosOption,children:[/*#__PURE__*/_jsx(Subscriber,{sub:mqttSub,unSub:mqttUnSub,showUnsub:isSubed}),/*#__PURE__*/_jsx(Publisher,{publish:mqttPublish})]}),/*#__PURE__*/_jsx(Receiver,{payload:payload,publish:mqttPublish})]});};export default HookMqtt;","map":{"version":3,"sources":["/home/one/NIN/nin_0.3.2/src/components/Hook/index.js"],"names":["React","createContext","useEffect","useState","Connection","Publisher","Subscriber","Receiver","mqtt","QosOption","qosOption","label","value","HookMqtt","client","setClient","isSubed","setIsSub","payload","setPayload","connectStatus","setConnectStatus","mqttConnect","host","mqttOption","connect","on","err","console","error","end","topic","message","toString","mqttDisconnect","mqttPublish","context","qos","publish","log","mqttSub","subscription","subscribe","mqttUnSub","unsubscribe"],"mappings":"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","sourcesContent":["import React, { createContext, useEffect, useState } from 'react';\nimport Connection from './Connection';\nimport Publisher from './Publisher';\nimport Subscriber from './Subscriber';\nimport Receiver from './Receiver';\nimport mqtt from 'mqtt';\n\nexport const QosOption = createContext([])\nconst qosOption = [\n  {\n    label: '0',\n    value: 0,\n  }, {\n    label: '1',\n    value: 1,\n  }, {\n    label: '2',\n    value: 2,\n  },\n];\n\nconst HookMqtt = () => {\n  const [client, setClient] = useState(null);\n  const [isSubed, setIsSub] = useState(false);\n  const [payload, setPayload] = useState({});\n  const [connectStatus, setConnectStatus] = useState('Connect');\n\n  const mqttConnect = (host, mqttOption) => {\n    setConnectStatus('Connecting');\n    setClient(mqtt.connect(host, mqttOption));\n  };\n\n  useEffect(() => {\n    if (client) {\n      client.on('connect', () => {\n        setConnectStatus('Connected');\n      });\n      client.on('error', (err) => {\n        console.error('Connection error: ', err);\n        client.end();\n      });\n      client.on('reconnect', () => {\n        setConnectStatus('Reconnecting');\n      });\n      client.on('message', (topic, message) => {\n        const payload = { topic, message: message.toString() };\n        setPayload(payload);\n      });\n    }\n  }, [client]);\n\n  const mqttDisconnect = () => {\n    if (client) {\n      client.end(() => {\n        setConnectStatus('Connect');\n      });\n    }\n  }\n\n  const mqttPublish = (context) => {\n    if (client) {\n      const { topic, qos, payload } = context;\n      client.publish(topic, payload, { qos }, error => {\n        if (error) {\n          console.log('Publish error: ', error);\n        }\n      });\n    }\n  }\n\n  const mqttSub = (subscription) => {\n    if (client) {\n      const { topic, qos } = subscription;\n      client.subscribe(topic, { qos }, (error) => {\n        if (error) {\n          console.log('Subscribe to topics error', error)\n          return\n        }\n        setIsSub(true)\n      });\n    }\n  };\n\n  const mqttUnSub = (subscription) => {\n    if (client) {\n      const { topic } = subscription;\n      client.unsubscribe(topic, error => {\n        if (error) {\n          console.log('Unsubscribe error', error)\n          return\n        }\n        setIsSub(false);\n      });\n    }\n  };\n\n  return (\n    <>\n      <Connection connect={mqttConnect} disconnect={mqttDisconnect} connectBtn={connectStatus} />\n      <QosOption.Provider value={qosOption}>\n        <Subscriber sub={mqttSub} unSub={mqttUnSub} showUnsub={isSubed} />\n        <Publisher publish={mqttPublish} />\n      </QosOption.Provider>\n      <Receiver payload={payload} publish={mqttPublish} />\n    </>\n  );\n}\n\nexport default HookMqtt;"]},"metadata":{},"sourceType":"module"}